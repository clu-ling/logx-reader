###############################
#
# time expressions
#
###############################
vars:
  actionFlow: identityAction

rules:
  - name: "month"
    label: Month
    type: token
    action: ${actionFlow}
    pattern: |
      January|February|March|April|May|June|July|August|September|October|November|December

  - name: "calendar-day"
    label: CalendarDay
    type: token
    action: ${actionFlow}
    pattern: |
      # August 12
      (?<=@Month) [word=/^\d{1,2}(nd|rd|th|st)?$/]
      |
      [word=/^\d{1,2}(nd|rd|th|st)?$/] (?=","? @Year)
      #added 'st' to allow for e.g. March 1st

  - name: "year"
    label: Year
    type: token
    action: ${actionFlow}
    pattern: |
      # in 2014
      (?<=[tag=IN]) [word=/^\d{4}$/]
      | 
      # "12 2020" or August 2020
      (?<=@Month|[word=/\d{1,2}(nd|rd|th|st)?/] ","?) [word=/^\d{4}$/]

  - name: "date"
    label: Date
    type: token
    action: ${actionFlow}
    pattern: |
      # "August 2020" or "August 3 2020"
      (?<month> @Month) (?<day> @Day)? ","? (?<year> @Year)

  - name: "date-slashed"
    label: Date
    type: token
    action: ${actionFlow}
    pattern: |
      # 01/05/1986
      [word=/^([0-9]{1,2}\/[0-9]{1,2}\/([0-9][0-9]){1,2})/]
      |
      # 01/86
      [word=/^([0-9]{1,2}\/([0-9][0-9]){1,2})/]

  - name: "date-YYYY-MM-DD"
    label: Date
    type: token
    action: ${actionFlow}
    pattern: |
      # 1986-12-21; 2012 - 06 - 15; 2021 11 30
      [word=/^(1[8-9]|2[0-1])\d\d\s?-?\s?(0[1-9]|1[0-2])\s?-?\s?([0-2]\d|3[0-1])$/]

  - name: "date-DD-mmm-YYYY"
    label: Date
    type: token
    action: ${actionFlow}
    pattern: |
      # 12 Jun 2021
      [word=/^(?i)([0-2]\d|3[0-1])\s?-?\s?(j(an|u[l,n])|a(ug|pr)|feb|mar|sep|oct|nov|dec)\s?-?\s?(1[8-9]|2[0-1])\d\d$/]

  - name: "on-time-expression"
    label: OnTimeExpression
    type: token
    action: ${actionFlow}
    pattern: |
      [lemma=/^(on|at|around|about)$/] @TimeExpression

  - name: "after-time-expression"
    label: AfterTimeExpression
    type: token
    action: ${actionFlow}
    pattern: |
      [word=/^(?i)(start|starting|beginning|from|after|following|since|past)$/] (?<date> @TimeExpression)

  - name: "before-time-expression"
    label: BeforeTimeExpression
    type: token
    action: ${actionFlow}
    pattern: |
      [lemma=/^(before|by|end|ending|until|to)$/] (?<date> @TimeExpression)

  - name: "interval-time-expression"
    label: IntervalTimeExpression
    type: token
    action: ${actionFlow}
    pattern: |
      [lemma=/^(since|until|during|through|throughout|over)$/] @TimeExpression
      #note that 'since', 'until' are both interval and after/before
      |
      (?<start> @AfterTimeExpression) (?<end> @BeforeTimeExpression)
      |
      [lemma=between] (?<start> @TimeExpression) [lemma=and] (?<end> @TimeExpression)
      # todo: add possibility of conjunction, ex. 'starting 9/20 and ending 11/20'

  - name: "time-unit"
    label: TimeUnit
    type: token
    action: ${actionFlow}
    pattern: |
      [tag=DT]* [tag=JJ]* [lemma=/^(second|minute|hour|day|week|month|year|annum|decade)$/ & tag=/^N/]
